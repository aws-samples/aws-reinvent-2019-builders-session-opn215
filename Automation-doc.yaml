schemaVersion: "0.3"
description: "SendReturnCodesToBranch"
parameters:
  InstanceId:
    type: "String"
    description: "Instance ID to test against"
  returnCode:
    type: "String"
    description: "ReturnCodeToTest"
mainSteps:
- name: "TestReturnCodes"
  action: "aws:runCommand"
  maxAttempts: 3
  onFailure: "Continue"
  timeoutSeconds: 600
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstanceId}}"
    Parameters:
      commands : |
         exit "{{returnCode}}"
- name: branchStuff
  action: aws:branch
  inputs:
    Choices:
    - NextStep: handleError128
      Variable: "{{TestReturnCodes.ResponseCode}}"
      NumericEquals : 128
    - NextStep: handleError128orGreater
      Variable: "{{TestReturnCodes.ResponseCode}}"
      NumericGreater: 128
    - NextStep: handleSuccess
      Variable: "{{TestReturnCodes.ResponseCode}}"
      NumericEquals: 0
    Default:
      catchAll
- name: sayHi
  action: "aws:runCommand"
  maxAttempts: 3
  onFailure: "Abort"
  timeoutSeconds: 600
  isEnd: true
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstanceId}}"
    Parameters:
      commands : |
         write-output "Hi"
- name: handleSuccess
  action: "aws:runCommand"
  maxAttempts: 3
  onFailure: "Abort"
  timeoutSeconds: 600
  isEnd: true
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstanceId}}"
    Parameters:
      commands : |
         write-output "Successfull Execution"
- name: handleError128
  action: "aws:runCommand"
  maxAttempts: 3
  onFailure: "Abort"
  timeoutSeconds: 600
  isEnd: true
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstanceId}}"
    Parameters:
      commands : |
         write-output "Specific Error Occurred"
- name: handleError128orGreater
  action: "aws:runCommand"
  maxAttempts: 3
  onFailure: "Abort"
  timeoutSeconds: 600
  isEnd: true
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstanceId}}"
    Parameters:
      commands : |
         write-output "Generic Error Occurred" 
- name: catchAll
  action: "aws:runCommand"
  maxAttempts: 3
  onFailure: "Abort"
  timeoutSeconds: 600
  isEnd: true
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstanceId}}"
    Parameters:
      commands : |
         write-output "Unhandled exception" 